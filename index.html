<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL 状態監視</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        #status {
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
        }
        .status-normal {
            color: green;
        }
        .status-error {
            color: red;
        }
        .status-maintenance {
            color: orange;
        }
        .download-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .download-btn:hover {
            background: #0056b3;
        }
        .admin-controls {
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            display: none; /* 初めは非表示 */
        }
        .admin-select {
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
        }
        .password-container {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>URL 状態監視</h1>
    <div id="status"></div>

    <!-- パスワード入力 -->
    <div class="password-container">
        <input type="password" id="admin-password" placeholder="管理者パスワードを入力" />
        <button id="loginBtn" class="download-btn">ログイン</button>
    </div>

    <div class="admin-controls" id="admin-controls">
        <label for="url-select">監視するURLを選択:</label>
        <select id="url-select" class="admin-select">
            <option value="">選択してください</option>
            <option value="0">https://fujiproject-off1cial.f5.si</option>
            <option value="1">https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAMAAF6JN5RUN0ZWMlowMzA4M0FJVjFUSjJMWEEySUNNNi4u</option>
        </select>

        <label for="admin-status">状態を選択:</label>
        <select id="admin-status" class="admin-select">
            <option value="">選択してください</option>
            <option value="正常">正常</option>
            <option value="異常">異常</option>
            <option value="メンテナンス中">メンテナンス中</option>
        </select>

        <label for="maintenance-message">メンテナンス予告:</label>
        <input type="text" id="maintenance-message" placeholder="予告内容を入力" class="admin-select" />

        <button id="setStatusBtn" class="download-btn">状態を設定</button>
    </div>

    <button id="downloadBtn" class="download-btn">生ログをダウンロード</button>

    <script>
        const adminPassword = "admin123"; // 管理者パスワード（例）
        const urls = [
            'https://fujiproject-off1cial.f5.si',
            'https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAMAAF6JN5RUN0ZWMlowMzA4M0FJVjFUSjJMWEEySUNNNi4u'
        ];
        let log = '';

        function checkStatus() {
            urls.forEach((url, index) => {
                fetch(url)
                    .then(response => {
                        const status = response.ok ? '正常' : '異常';
                        const statusClass = response.ok ? 'status-normal' : 'status-error';
                        const logEntry = `${new Date().toISOString()} - ${url}: ${status} (ステータスコード: ${response.status})\n`;

                        // ステータス表示
                        document.getElementById('status').innerHTML += `<p class="${statusClass}">${logEntry}</p>`;
                        log += logEntry; // ログに追加

                        // メンテナンス中のメッセージを表示
                        const maintenanceMessage = document.getElementById('maintenance-message').value;
                        if (maintenanceMessage && document.getElementById('admin-status').value === 'メンテナンス中') {
                            document.getElementById('status').innerHTML += `<p class="status-maintenance">【メンテナンス予告】${maintenanceMessage}</p>`;
                        }
                    })
                    .catch(error => {
                        const errorEntry = `${new Date().toISOString()} - ${url}: エラー - ${error.message}\n`;
                        document.getElementById('status').innerHTML += `<p class="status-error">${errorEntry}</p>`;
                        log += errorEntry; // ログに追加
                    });
            });
        }

        // 30秒ごとに状態をチェック
        setInterval(checkStatus, 30000);

        // 最初のチェックを即実行
        checkStatus();

        // ダウンロード機能
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const blob = new Blob([log], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'url_status_log.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // 管理者専用の状態設定機能
        document.getElementById('setStatusBtn').addEventListener('click', () => {
            const selectedStatus = document.getElementById('admin-status').value;
            const selectedUrlIndex = document.getElementById('url-select').value;

            if (selectedStatus && selectedUrlIndex !== "") {
                const logEntry = `${new Date().toISOString()} - 管理者による設定: ${selectedStatus} (${urls[selectedUrlIndex]})\n`;
                const statusClass = selectedStatus === '正常' ? 'status-normal' :
                                    selectedStatus === '異常' ? 'status-error' :
                                    'status-maintenance';

                document.getElementById('status').innerHTML += `<p class="${statusClass}">${logEntry}</p>`;
                log += logEntry; // ログに追加

                // メンテナンス予告がある場合は表示
                const maintenanceMessage = document.getElementById('maintenance-message').value;
                if (selectedStatus === 'メンテナンス中' && maintenanceMessage) {
                    const maintenanceEntry = `${new Date().toISOString()} - メンテナンス予告: ${maintenanceMessage}\n`;
                    document.getElementById('status').innerHTML += `<p class="status-maintenance">【メンテナンス予告】${maintenanceMessage}</p>`;
                    log += maintenanceEntry; // ログに追加
                }
            }
        });

        // ログイン機能
        document.getElementById('loginBtn').addEventListener('click', () => {
            const inputPassword = document.getElementById('admin-password').value;
            if (inputPassword === adminPassword) {
                document.getElementById('admin-controls').style.display = 'block'; // 管理者用のコントロールを表示
                alert('ログイン成功！');
            } else {
                alert('パスワードが間違っています。');
            }
        });
    </script>
</body>
</html>
